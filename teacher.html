<!DOCTYPE html><html lang="ja"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"><title>Authデバッグ</title>
<body>
<h2>Googleログイン デバッグ</h2>
<div id="status" style="white-space:pre-line;border:1px solid #ccc;padding:8px;margin:8px 0;"></div>
<div id="ui"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signInWithPopup, signInWithRedirect, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  /apiKey: "AIzaSyBzRI3ReUylTAyRhUusWiSyShUMA-mqfAw",
  authDomain: "web1-fc8d7.firebaseapp.com",
  projectId: "web1-fc8d7",
  storageBucket: "web1-fc8d7.firebasestorage.app",
  messagingSenderId: "186079003085",
  appId: "1:186079003085:web:b4bfb7a359017366e70484",
  measurementId: "G-HHSR5ZTG15"/
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const $ = s=>document.querySelector(s);
const log = (t)=> { $("#status").textContent += t + "\n"; };

log("ページ読込 OK");
log("authDomain: " + (firebaseConfig.authDomain||"(未設定)"));
log("location.host: " + location.host);

function renderLoggedOut(){
  $("#ui").innerHTML = `
    <button id="popup">Googleでサインイン（ポップアップ）</button>
    <button id="redirect">Googleでサインイン（リダイレクト）</button>
  `;
  $("#popup").onclick = async ()=>{
    try { await signInWithPopup(auth, new GoogleAuthProvider()); }
    catch(e){ log("popup error: " + e.message); }
  };
  $("#redirect").onclick = async ()=>{
    try { await signInWithRedirect(auth, new GoogleAuthProvider()); }
    catch(e){ log("redirect error: " + e.message); }
  };
}

function renderLoggedIn(u){
  $("#ui").innerHTML = `${u.email} でログイン中 <button id="out">サインアウト</button>`;
  $("#out").onclick = ()=>signOut(auth);
}

onAuthStateChanged(auth, (u)=>{
  log("onAuthStateChanged: " + (u? "ログイン済" : "未ログイン"));
  if(u) renderLoggedIn(u); else renderLoggedOut();
});

// エラーを画面にも出す
window.addEventListener("error", (e)=> log("window.error: "+e.message));
window.addEventListener("unhandledrejection",(e)=> log("promise reject: "+(e.reason?.message||e.reason)));
</script>
</body></html>
